:root{
  /* Playful, vibrant palette */
  --text:#12131a;
  --muted:#7a7e9a;
  --primary:#6f5cff;           /* violet */
  --primary-600:#5b47ff;
  --primary-200:#e7e4ff;
  --accent-pink:#ff6fb1;
  --accent-coral:#ff6a4d;
  --accent-yellow:#ffd44d;
  --accent-green:#19c37d;
  --accent-sky:#64d2ff;
  --card:#ffffffcc;             /* translucent for glass effect */
  --ring:rgba(111,92,255,0.35);
  --shadow:0 18px 55px rgba(31,35,70,.12), 0 2px 10px rgba(31,35,70,.06);
  --outline:#12131a;
  --line:2px;
  --radius:18px;
  --icon-stroke:2.2;
  --shadow-offset:6px;
  --bg:#d9cffb;
  --sidebar-bg:#c9b7ff;
  --headline-gradient: linear-gradient(90deg,var(--primary), var(--accent-pink), var(--accent-sky));
  --brand-text-color:#12131a;
  --brand-gradient: none;
  /* Jiggle variables */
  --widget-jiggle-rot: 0.25deg;   /* softer wobble */
  --widget-jiggle-speed: .45s;    /* slightly slower */
  /* Global UI scale (0.8 = 20% smaller) */
  --ui-scale: 0.8;
  /* Static app viewport size (not responsive) */
  --app-width: 1280px;
  --app-height: 800px;
  /* Layout dimensions */
  --sidebar-width: 260px;
  --content-pad-x: 52px; /* 26px left + 26px right from .content */
  --content-fixed-width: calc(var(--app-width) - var(--sidebar-width) - var(--content-pad-x));
}
.theme-sunset{
  --primary:#ff5cff;
  --primary-600:#ff47d8;
  --primary-200:#ffe3fb;
  --accent-pink:#ff89c7; --accent-coral:#ff7a5f; --accent-yellow:#ffe073; --accent-green:#17c99b; --accent-sky:#79e0ff;
  --bg: radial-gradient(1100px 520px at 75% -10%, rgba(255,138,199,0.3), transparent 60%),
        radial-gradient(900px 520px at -15% 5%, rgba(121,224,255,0.28), transparent 55%),
        linear-gradient(180deg,#fff6ff 0%, #fff9f3 60%, #ffffff 100%);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  color:var(--text);
  /* Use a fixed-size glass background layer, not responsive */
  background: transparent;
  position: relative;
}
/* Fixed-size background layer anchored top-left to keep vibrancy static */
body::before{
  content:"";
  position: fixed; inset:auto auto auto auto; top:0; left:0;
  width: 100vw; height: 100vh;
  pointer-events:none; z-index:-1;
  background: var(--bg-static, var(--bg));
  background-repeat:no-repeat; background-size: auto; background-position: top left;
}
.app-shell{
  display:grid; grid-template-columns: var(--sidebar-width) 1fr;
  /* Fill the viewport while honoring the UI scale */
  transform: scale(var(--ui-scale));
  transform-origin: top left;
  width: calc(100vw / var(--ui-scale));
  height: calc(100vh / var(--ui-scale));
}

/* Sidebar */
.sidebar{
  background:var(--sidebar-bg, #c9b7ff);
  color:#12131a; padding:18px; display:flex; flex-direction:column; gap:14px; 
  /* Remove outer glow/drop shadow for a cleaner rail */
  box-shadow: none;
  border:var(--line) solid var(--outline);
  position:relative; z-index:100; /* keep sidebar above sticky subnav */
}
/* Left-rail subtab list (optional, shown for the active main section) */
.nav-subgroup{display:flex; flex-direction:column; gap:4px; margin:4px 0 10px 32px}
.nav-subitem{
  border-radius:10px; padding:8px 10px; font-size:13px; color:#3f3f56; cursor:pointer;
  text-decoration:none; background:transparent; border:1px dashed transparent; user-select:none;
  transition: background-color .28s cubic-bezier(.25,.8,.25,1), color .24s ease, border-color .28s ease;
}
.nav-subitem:hover:not(.is-current){
  /* Let page tint show through: no fake color overlay */
  background: rgba(255,255,255,0.24);
  border-color: rgba(255,255,255,.45);
  backdrop-filter: saturate(160%) blur(6px);
  box-shadow: 0 3px 10px rgba(31,35,70,.08);
  font-weight:700;
}
.nav-subitem.is-current{
  /* Glassy active state for left-rail subtabs (more translucent) */
  background: rgba(255,255,255,0.28);
  border: 1px solid rgba(255,255,255,0.45);
  backdrop-filter: saturate(160%) blur(8px);
  box-shadow: 0 4px 12px rgba(31,35,70,.08);
  font-weight:700;
}
.brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px}
.logo{width:36px;height:36px;border-radius:12px; background:rgba(255,255,255,.22); display:grid; place-items:center; color:#fff; font-weight:800; backdrop-filter:saturate(160%) blur(6px)}
/* art-style logo */
.logo{border-radius:10px; background:#ffffff; color:#12131a; border:var(--line) solid var(--outline); box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.2)}
.nav{display:flex; flex-direction:column; gap:6px; margin-top:8px}
.nav-item{display:flex; align-items:center; gap:10px; padding:12px 12px; border-radius:var(--radius); color:#12131a; text-decoration:none; transition: background-color .28s cubic-bezier(.25,.8,.25,1), color .24s ease}
.nav-item .icon{width:24px; text-align:center}
.nav-item .icon svg{width:20px;height:20px; stroke:var(--outline); fill:none; stroke-width:var(--icon-stroke); stroke-linecap:var(--icon-cap,round); stroke-linejoin:var(--icon-join,round)}
.nav-item:hover:not(.active){
  background: rgba(255,255,255,0.24);
  border: 1px solid rgba(255,255,255,.45);
  backdrop-filter: saturate(160%) blur(6px);
  box-shadow: 0 4px 12px rgba(31,35,70,.08);
  font-weight:700;
}
.nav-item.active{
  /* Glassy active state for main left nav items (more translucent) */
  background: rgba(255,255,255,0.50);
  color:#12131a;
  border: 1px solid rgba(255,255,255,0.45);
  backdrop-filter: saturate(160%) blur(8px);
  box-shadow: 0 5px 14px rgba(31,35,70,.10);
  font-weight:700;
}
.sidebar-footer{margin-top:auto; display:flex; flex-direction:column; gap:6px}

/* Content */
.content{padding:22px 26px; overflow:auto; min-width:0}
.topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px}
.topbar h1{font-size:22px; margin:0; font-family:var(--font-heading, var(--font-body, Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial))}
.gradient-text{background:var(--headline-gradient); -webkit-background-clip:text; background-clip:text; color:transparent}
.actions{display:flex; align-items:center; gap:10px}
.search{position:relative}
.search input{
  border:1px solid #e7e7f3; border-radius:14px; padding:10px 12px; width:260px; outline:none;
  background:rgba(255,255,255,0.6);
}
.search input:focus{box-shadow:0 0 0 4px var(--ring); border-color:transparent}
.icon-btn{border:var(--line) var(--outline-style, solid) var(--outline); background:#fff; box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.2); width:40px; height:40px; border-radius:var(--radius); cursor:pointer}
.icon-btn svg{width:20px;height:20px;stroke:var(--outline);fill:none;stroke-width:var(--icon-stroke); stroke-linecap:var(--icon-cap,round); stroke-linejoin:var(--icon-join,round)}
.avatar{width:36px;height:36px;border-radius:10px; background:#fff; display:grid; place-items:center; font-weight:700; border:var(--line) var(--outline-style, solid) var(--outline); box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.2)}

/* Branding name gradient/color inside sidebar */
.sidebar .brand span{background:var(--brand-gradient); -webkit-background-clip:text; background-clip:text; color:var(--brand-text-color, #12131a)}

/* Cards */
.cards{display:grid; grid-template-columns:repeat(4,minmax(180px,1fr)); gap:20px; margin:14px 0 18px}
/* glassy gradient border */
.stat-card{
  border-radius:22px; padding:16px; display:flex; align-items:center; gap:12px; position:relative;
  background:rgba(255,255,255,0.42); border:1px solid rgba(255,255,255,0.55);
  backdrop-filter:saturate(180%) blur(14px);
  box-shadow:0 12px 36px rgba(31,35,70,.16);
}
.stat-icon{width:44px;height:44px;border-radius:12px; display:grid; place-items:center; background:#f5f5f5; color:#222; border:var(--line) var(--outline-style, solid) var(--outline)}
.stat-icon svg{width:24px;height:24px; stroke:var(--outline); fill:none; stroke-width:var(--icon-stroke)}
.cards .stat-card:nth-child(1) .stat-icon{background:linear-gradient(145deg,var(--primary-200),#fff)}
.cards .stat-card:nth-child(2) .stat-icon{background:linear-gradient(145deg,#ffe6f1,#fff)}
.cards .stat-card:nth-child(3) .stat-icon{background:linear-gradient(145deg,#e6fff5,#fff)}
.cards .stat-card:nth-child(4) .stat-icon{background:linear-gradient(145deg,#fff4e0,#fff)}
.stat-meta{display:flex; flex-direction:column}
.stat-value{font-size:20px; font-weight:800}
.stat-label{font-size:12px; color:var(--muted)}
.stat-card .dots{position:absolute; right:10px; top:10px; border:none; background:transparent; font-size:22px; color:#c3c4d6; cursor:pointer}

/* Panels */
.grid{display:grid; grid-template-columns:repeat(3,1fr); gap:16px}
.panel{
  border-radius:22px; padding:16px; display:flex; flex-direction:column;
  background:rgba(255,255,255,0.42); border:1px solid rgba(255,255,255,0.55);
  backdrop-filter:saturate(180%) blur(14px);
  box-shadow:0 12px 36px rgba(31,35,70,.16);
  will-change: transform, box-shadow; transition: transform .15s ease, box-shadow .15s ease;
}
.panel:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 40px rgba(31,35,70,.18);
}
.panel.span-2{grid-column:span 2}
.panel-header{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px}
.panel h2{font-size:16px; margin:0; font-family:var(--font-heading, var(--font-body, Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial))}
.segmented{display:inline-flex; background:#ece5ff; border-radius:12px; padding:4px; border:var(--line) var(--outline-style, solid) var(--outline)}
.segmented button{border:none; background:transparent; padding:6px 10px; border-radius:8px; color:#3f3f56; cursor:pointer}
.segmented .active{background:#fff; color:#12131a; box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.15); border:var(--line) solid var(--outline)}
.muted{color:var(--muted); font-size:12px}
.chart-box{position:relative; height:260px}
.panel canvas{width:100% !important; display:block}
.legend{display:flex; align-items:center; gap:12px; margin-top:10px; color:var(--muted); font-size:12px}
.dot{width:10px;height:10px;border-radius:50%; display:inline-block; margin-right:4px}
.dot-posts{background:#6f5cff}
.dot-carousels{background:#5cc2ff}
.dot-stories{background:#ffa657}

/* Table */
.table-wrap{overflow:auto}
.table{width:100%; border-collapse:separate; border-spacing:0 8px}
.table th{font-size:12px; text-align:left; color:var(--muted); padding:8px 10px}
/* glassy table headers */
.table thead th{
  background:rgba(255,255,255,0.5);
  border:1px solid rgba(255,255,255,0.55);
  backdrop-filter:saturate(160%) blur(10px);
}
.table th.sortable{cursor:pointer; user-select:none}
.table th.sortable::after{content:''; margin-left:6px; border:4px solid transparent; border-top-color:#b9bdd3; display:inline-block; transform:translateY(2px)}
.table th.sortable.sort-desc::after{border-top-color:transparent; border-bottom-color:#b9bdd3; transform:translateY(-2px)}
.table td{
  background:rgba(255,255,255,0.6);
  padding:12px 10px;
  border-top:1px solid rgba(255,255,255,0.55);
  border-bottom:1px solid rgba(255,255,255,0.55);
}
.table tbody td:first-child{ border-top-left-radius:12px; border-bottom-left-radius:12px }
.table tbody td:last-child{ border-top-right-radius:12px; border-bottom-right-radius:12px }
.table tbody tr:hover td{
  background:rgba(255,255,255,0.72);
  box-shadow:0 6px 18px rgba(31,35,70,.14);
}

/* Collections placeholder styles removed */
/* Config UI helpers */
.cfg-table{ width:100%; border-collapse:separate; border-spacing:0 6px }
.cfg-table th{ text-align:left; font-size:12px; color:var(--muted); padding:6px 8px }
.cfg-table td{ background:rgba(255,255,255,0.6); padding:8px; border-top:1px solid rgba(255,255,255,0.55); border-bottom:1px solid rgba(255,255,255,0.55) }
.cfg-table tbody td:first-child{ border-top-left-radius:10px; border-bottom-left-radius:10px }
.cfg-table tbody td:last-child{ border-top-right-radius:10px; border-bottom-right-radius:10px }
.cfg-chip{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; background:#f4f1ff; font-size:11px; font-weight:700 }
.cfg-row-actions{ display:flex; gap:6px; align-items:center }
.cfg-grid{ display:grid; gap:8px }
.cfg-row{ display:grid; grid-template-columns: 160px 1fr; gap:8px; align-items:center }
.cfg-token{ display:inline-block; width:16px; height:16px; border-radius:4px; border:1px solid rgba(0,0,0,.06) }

/* Receivables: risk bar + legend */
.riskbar{
  display:flex; height:18px; border-radius:999px; overflow:hidden;
  border:var(--line) var(--outline-style, solid) var(--outline); background:#fff;
  box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.12);
}
.riskbar-fill{height:100%}
.riskbar-fill.low{background:linear-gradient(90deg,#e8fff5,#c9ffe7)}
.riskbar-fill.med{background:linear-gradient(90deg,#fff6e8,#ffe9c9)}
.riskbar-fill.high{background:linear-gradient(90deg,#ffeaea,#ffd4d4)}
.risk-legend{display:flex; gap:12px; list-style:none; padding:10px 0 0; margin:0; color:var(--muted); font-size:12px}
.risk-legend .chip{display:inline-block; width:10px; height:10px; border-radius:3px; margin-right:6px}
.risk-legend .chip.low{background:#19c37d}
.risk-legend .chip.med{background:#ffd44d}
.risk-legend .chip.high{background:#cc3a3a}

/* Receivables: small utilities reusing your layout */
.subtab-panel[data-subtab-panel^="recv-"] .panel + .panel{margin-top:16px}

/* Reduced responsiveness: keep layout stable until very small widths */
@media (max-width: 900px){
  /* keep default grids; no panel span overrides */
}

/* Heading font application */
h1, h2, h3, .widget-title, .stat-value, .brand span { font-family: var(--font-heading, var(--font-body, Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial)); }

@media (max-width: 560px){
  /* Make the whole page respond only at this break */
  /* Topbar is the only section allowed to flex/stretch */
  .topbar{ flex-wrap: wrap; gap:8px }
  .topbar h1{ margin-bottom:4px }
  .actions{ flex: 1 1 100%; display:flex; gap:8px }
  .search{ flex:1 }
  .search input{ width:100% }
}

/* Compact base (reduce sizes ~80% without transform) */
/* Tokens */
:root{
  --widget-col: 160px;        /* fixed widget column width */
  --widget-row: 160px;        /* fixed widget row height */
  --radius: 16px;             /* slightly smaller corners */
}

/* Typography and paddings */
body{ font-size:12px }
.topbar h1{ font-size:18px }
.nav-item{ padding:9px 10px }
.nav-item .icon svg{ width:18px; height:18px }
.nav-subitem{ padding:6px 8px; font-size:12px }
.search input{ width:210px; padding:8px 10px; border-radius:12px }
.actions{ gap:8px }
.icon-btn{ width:34px; height:34px; border-radius:14px }
.avatar{ width:32px; height:32px; border-radius:9px }

/* Subtabs */
.subtab{ padding:8px 10px; border-radius:10px }

/* Widgets */
.widget-grid{ gap:12px }
.widget-card{ padding:12px; border-radius:18px }
.widget-glyph{ width:16px; height:16px }
.mini-btn{ padding:5px 8px; border-radius:9px; font-size:12px }
.links-wrap .link{ padding:6px 10px }

/* Tables */
.table th{ font-size:11px; padding:6px 8px }
.table td{ padding:10px 8px }
/* Major looks ------------------------------------------------------------ */
body[data-look="outlined"] {
  --outline:#12131a; --line:2px; --outline-style:solid; --radius:18px; --shadow-offset:6px; --card-fill:#fff;
}
body[data-look="mint"] {
  --outline:#d9e5df; --line:1px; --outline-style:solid; --radius:14px; --shadow-offset:0px; --card-fill:#ffffff;
  --bg: linear-gradient(180deg,#f0faf7 0%, #f7fbfa 60%, #ffffff 100%);
  --sidebar-bg:#e9f5f2; --headline-gradient: linear-gradient(90deg,#0ea5a5,#16a34a);
}
body[data-look="glass"] {
  --outline:rgba(255,255,255,0.35); --line:1px; --outline-style:solid; --radius:20px; --shadow-offset:0px; 
  /* Slightly richer saturation (+~2%) and an extra cool tint stop */
  --bg-static:
        radial-gradient(1100px 640px at left -140px top -80px, rgba(255,155,155,.34), transparent 60%),
        radial-gradient(1100px 640px at right -140px top -80px, rgba(155,155,255,.34), transparent 60%),
        linear-gradient(180deg,#fff5f5 0%, #f6f1ff 50%, #eef9ff 85%, #ffffff 100%);
  /* Fallback (unused when --bg-static applied) */
  --bg: linear-gradient(180deg,#fff5f5 0%, #f6f1ff 50%, #eef9ff 85%, #ffffff 100%);
  --sidebar-bg:rgba(255,255,255,0.6); 
  /* Update greeting name color (soft violet -> aqua -> mint) */
  --headline-gradient: linear-gradient(90deg,#de7710,#a834d3);
}

/* Glass specifics */
body[data-look="glass"] .panel,
body[data-look="glass"] .stat-card {
  background: rgba(255,255,255,0.42);
  border:1px solid rgba(255,255,255,0.55);
  backdrop-filter: saturate(180%) blur(14px);
  box-shadow: 0 12px 36px rgba(31,35,70,.16);
  border-radius:22px;
}
body[data-look="glass"] .sidebar { background: linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.35)); border-color: rgba(255,255,255,0.45); }


/* Subnav (secondary tabs) */
.subnav{
  position: sticky; top:0; z-index:10;
  display:flex; align-items:center; gap:6px;
  /* Compact rail */
  padding:4px 6px; margin:0 0 8px;
  /* More translucent so page gradient shows through */
  background:linear-gradient(180deg, rgba(255,255,255,.64), rgba(255,255,255,.42));
  border-radius:14px;
  box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.12);
  backdrop-filter:saturate(160%) blur(10px);
}
.subtab{
  /* Match main nav: invisible by default (no container) */
  border: none;
  background: transparent;
  padding:8px 10px; border-radius:10px; font-weight:400; font-size:12px;
  background-clip: padding-box;
  cursor:pointer;
  will-change: background-color, box-shadow, transform;
  transition:
    background-color .28s cubic-bezier(.25,.8,.25,1),
    box-shadow .28s cubic-bezier(.25,.8,.25,1),
    color .24s ease,
    transform .16s ease;
  box-shadow: none;
}
.subtab:is(:hover,:focus-visible){
  transform:translateY(-1px);
}
.subtab:hover:not(.is-active){
  /* Let page gradient tint show through (no added color) */
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,.45);
  border-radius:10px;
  backdrop-filter: saturate(160%) blur(6px);
  box-shadow: 0 4px 12px rgba(31,35,70,.08);
  font-weight:700;
}
.subtab.is-active{
  /* Slightly less transparent than hover for active emphasis */
  background: rgba(255,255,255,0.24);
  outline:none;
  border-radius:10px;
  box-shadow: 0 4px 12px rgba(31,35,70,.08);
  border: 1px solid rgba(255,255,255,0.45);
  backdrop-filter: saturate(160%) blur(6px);
  font-weight:700;
}
/* slightly more tactile focus */
.subtab:focus-visible{
  outline:none;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,.45);
  border-radius:10px;
  backdrop-filter: saturate(160%) blur(6px);
  box-shadow: 0 4px 12px rgba(31,35,70,.08), 0 0 0 2px var(--ring);
  font-weight:700;
}
.subtab-panel.is-hidden{display:none}

/* Keep subtab nav and panels at fixed content width; allow x-scroll when viewport is smaller */
.subnav, .subtab-panel{ min-width: var(--content-fixed-width) }

/* Generic utility to hide any block when toggled */
.is-hidden{display:none !important}


/* ================= Collections (AR Timeline) ================= */
#ar-block{ --pad:12px; --row-gap:12px; --cell-y:12px; --meta-gap:8px; --chip-y:4px; --line-height:1.5; display:grid; grid-template-columns:1.25fr 1fr; gap:16px }
@media (max-width: 1000px){ #ar-block{grid-template-columns:1fr} }

.glass{
  background:linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.48));
  border:1px solid rgba(255,255,255,0.55);
  backdrop-filter:saturate(180%) blur(16px);
  border-radius:22px;
  box-shadow:0 24px 50px rgba(31,35,70,.12), inset 0 1px 0 rgba(255,255,255,.55), 0 1px 0 rgba(255,255,255,.35);
}
.glass-header{ background:linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.62)); border-bottom:1px solid rgba(255,255,255,.55); padding:12px 14px; border-top-left-radius:22px; border-top-right-radius:22px; display:flex; align-items:center; justify-content:space-between; gap:12px }

.ar-actions{display:flex; gap:8px; flex-wrap:wrap}
.ar-input,.ar-select,.ar-btn{ border-radius:14px; border:1px solid #e7e7f3; background:#fff; color:var(--text); font-size:12px }
.ar-input{ padding:8px 10px; outline:none }
.ar-input:focus,.ar-select:focus,.ar-textarea:focus{ box-shadow:0 0 0 4px var(--ring); border-color:transparent }
.ar-btn{ padding:8px 10px; cursor:pointer; background:#fff; font-weight:800; letter-spacing:.2px }
.ar-btn.primary{ background:linear-gradient(145deg, var(--primary-200), #fff) padding-box, linear-gradient(145deg, var(--primary), var(--primary-600)) border-box; border:2px solid transparent; color:#2b2366 }

.density-toggle{ display:inline-flex; background:#ece5ff; border:var(--line) solid var(--outline); border-radius:12px; padding:4px }
.density-toggle button{ border:none; background:transparent; padding:6px 10px; border-radius:8px; color:#3f3f56; cursor:pointer; font-weight:800; font-size:11px }
.density-toggle .active{ background:#fff; color:#12131a; box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.15) }

.ar-table{ width:100%; border-collapse:separate; border-spacing:0 var(--row-gap) }
.ar-table thead th{ font-size:11px; color:var(--muted); text-align:left; padding:8px 10px; background:rgba(255,255,255,.62); border:1px solid rgba(255,255,255,.55); backdrop-filter:blur(10px) }
.ar-table td{ background:rgba(255,255,255,.66); padding:var(--cell-y) 10px; border-top:1px solid rgba(255,255,255,.55); border-bottom:1px solid rgba(255,255,255,.55) }
.ar-table tbody td:first-child{border-top-left-radius:12px; border-bottom-left-radius:12px}
.ar-table tbody td:last-child{ border-top-right-radius:12px; border-bottom-right-radius:12px }
.ar-table tbody tr{ cursor:pointer }
.ar-table tbody tr:hover td{ background:rgba(255,255,255,.82); box-shadow:0 6px 18px rgba(31,35,70,.14) }

.ar-pill{ display:inline-flex; align-items:center; gap:6px; padding:calc(var(--chip-y)) 10px; border-radius:999px; font-weight:800; font-size:11px; border:1px solid rgba(255,255,255,.7) }
.ar-s-pending{   background:#f0e9ff; color:#5a3fff }
.ar-s-contacted{ background:#e6f7ff; color:#045079 }
.ar-s-promised{  background:#fff7d6; color:#7a5b00 }
.ar-s-overdue{   background:#ffeaea; color:#b91c1c }
.ar-s-escalated{ background:linear-gradient(145deg,#ffe3fb,#fff); color:#a31967 }
.ar-s-paid{      background:#ecfdf5; color:#047857 }
.ar-sla{ display:inline-flex; align-items:center; gap:6px; padding:calc(var(--chip-y)) 8px; background:#ffeaea; color:#b91c1c; border:1px solid rgba(255,255,255,.7); border-radius:999px; font-weight:900; font-size:11px }

.ar-detail{ display:grid; grid-template-rows:auto auto 1fr auto; height:100%; overflow:auto; -webkit-overflow-scrolling:touch; scrollbar-gutter: stable both-edges }
.ar-meta-grid{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:var(--meta-gap); padding:var(--pad) }
@media (max-width: 680px){ .ar-meta-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
.ar-meta-2col{ grid-template-columns: repeat(2, minmax(0,1fr)); }
.ar-meta-grid .ar-section-title{ grid-column: 1 / -1; font-size:11px; font-weight:900; color:var(--muted); letter-spacing:.3px; margin:4px 0 2px }
.ar-meta-grid .span-2{ grid-column: 1 / -1 }
.kv{ display:flex; flex-direction:column; gap:4px }
.kv label{ font-size:10px; color:var(--muted); font-weight:800; letter-spacing:.2px }
.kv .val{ background:#fff; border:1px solid #e7e7f3; border-radius:12px; padding:8px 10px; display:flex; align-items:center; gap:8px; min-height:32px }
.kv .val.select select, .kv .val input{ border:1px solid #e7e7f3; border-radius:10px; padding:6px 8px; font-size:11px; width:100% }
.badge{ display:inline-flex; align-items:center; gap:6px; padding:calc(var(--chip-y)) 10px; border-radius:999px; font-size:11px; font-weight:800; background:#f0e9ff; color:#5a3fff; border:1px solid rgba(255,255,255,.7) }
.tags{ display:flex; gap:8px; flex-wrap:wrap }
.tag{ background:#fff; border:1px solid #e7e7f3; border-radius:999px; padding:4px 10px; font-size:11px; font-weight:700; color:#3f3f56 }
.tag.add{ background:#f7f7ff; cursor:text }

.meta-divider{ height:1px; background:rgba(255,255,255,.55); margin:0 var(--pad) }
.ar-seg{ margin:var(--pad); display:inline-flex; background:#ece5ff; border-radius:12px; padding:4px; border:var(--line) solid var(--outline) }
.ar-seg button{ border:none; background:transparent; padding:6px 10px; border-radius:8px; color:#3f3f56; cursor:pointer; font-weight:800; font-size:11px }
.ar-seg .active{ background:#fff; color:#12131a; box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.15); border:var(--line) solid var(--outline) }

.ar-timeline{ padding:var(--pad); overflow:visible; display:flex; flex-direction:column; gap:var(--row-gap) }

/* Collections panel: make columns match height based on viewport */
[data-subtab-panel="col-overview"] .panel,
[data-subtab-panel="col-master"] .panel{ display:flex; flex-direction:column; min-height:0 }
[data-subtab-panel="col-overview"] .panel .panel-header,
[data-subtab-panel="col-master"] .panel .panel-header{ flex:0 0 auto }
[data-subtab-panel="col-overview"] #ar-block,
[data-subtab-panel="col-master"] #ar-block{ flex:1 1 auto; min-height:0; height: calc(100vh - 80px) }
#ar-block > .glass, #ar-block > .ar-detail{ height:100%; overflow:auto; -webkit-overflow-scrolling:touch }

@media (max-height: 720px){
  [data-subtab-panel="col-overview"] #ar-block,
  [data-subtab-panel="col-master"] #ar-block{ height: calc(100vh - 80px) }
}
.ar-day{ position:sticky; top:0; z-index:1; display:inline-flex; align-items:center; gap:8px; background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.72)); padding:6px 10px; border-radius:12px; color:#534a93; font-weight:900; letter-spacing:.2px; border:1px solid rgba(255,255,255,.6) }
.ar-evt{ display:grid; grid-template-columns:28px 1fr; gap:12px }
.ar-glyph{ width:22px; height:22px; border-radius:8px; display:grid; place-items:center; background:linear-gradient(145deg,#fff,var(--primary-200)); border:1px solid #e7e7f3; color:#2b2366; font-weight:900 }
.ar-evtcard{ background:rgba(255,255,255,.96); border:1px solid rgba(255,255,255,0.75); border-radius:16px; padding:12px 14px; display:flex; flex-direction:column; gap:10px; box-shadow:0 12px 30px rgba(31,35,70,.10) }
.ar-evt-top{ display:flex; align-items:center; justify-content:space-between; gap:10px }
.ar-evt-meta{ display:flex; align-items:center; gap:12px; color:#7a7e9a; font-size:11px; line-height:var(--line-height) }
.ar-tag{ display:inline-flex; align-items:center; gap:6px; padding:calc(var(--chip-y)) 10px; border-radius:999px; font-weight:800; font-size:11px; border:1px solid rgba(255,255,255,0.7); background:#f0e9ff; color:#5a3fff }
.ar-evt-body{ line-height:var(--line-height); font-size:12px }
.ar-evt-body .more{ color:#534a93; font-weight:800; cursor:pointer; margin-left:6px }
.ar-evt-body .tok{ background:#f0e9ff; color:#5a3fff; border-radius:6px; padding:0 4px; font-weight:800; font-size:11px }
.ar-ava{ width:20px; height:20px; border-radius:8px; background:linear-gradient(145deg,#fff,#f0e9ff); display:inline-grid; place-items:center; font-size:10px; font-weight:900; color:#5a3fff; border:1px solid #e7e7f3 }

.ar-compose{ border-top:1px solid rgba(255,255,255,.55); background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.72)); padding:var(--pad); display:grid; gap:10px }
.ar-row{ display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap }
.ar-textarea{ flex:1; min-height:96px; resize:vertical; padding:12px 14px; border-radius:16px; border:1px solid #e7e7f3; background:#fff; line-height:var(--line-height); font-size:12px }
.ar-roll{ display:grid; grid-template-columns:repeat(5,1fr); gap:10px; padding:10px; border-top:1px solid rgba(255,255,255,.55); background:rgba(255,255,255,.72) }
.ar-tile{ background:rgba(255,255,255,.86); border:1px solid rgba(255,255,255,.65); border-radius:14px; padding:10px; box-shadow:0 10px 26px rgba(31,35,70,.10) }
.ar-tile h4{ margin:0; font-size:12px; color:var(--muted) }
.ar-tile strong{ font-size:16px }
.ar-follow{ margin-top:12px; padding:0 var(--pad) var(--pad) }
.ar-fitem{ display:flex; align-items:center; justify-content:space-between; padding:10px; background:rgba(255,255,255,.86); border:1px solid rgba(255,255,255,.65); border-radius:14px; margin-top:8px; box-shadow:0 10px 26px rgba(31,35,70,.10) }

/* ------------------------- Widget System (iOS-like) ---------------------- */
.master-wrap{ overflow:auto; max-height: calc(100vh - 160px) }
.master-table{ width:100%; border-collapse:separate; border-spacing:0 6px }
.master-table thead th{ position:sticky; top:0; z-index:2; background:rgba(255,255,255,.9); backdrop-filter:blur(10px); border-bottom:1px solid rgba(0,0,0,.06) }
.master-table thead th.pinned{ z-index:4 }
.master-table thead tr.alias-row th, .master-table thead tr.filter-row th{ display:none }
.master-table thead input{ width:100%; box-sizing:border-box; font-size:11px; padding:4px 6px; border:1px solid #e7e7f3; border-radius:8px; background:#fff }
.master-table tbody td{ background:rgba(255,255,255,.66); padding:10px 8px; border-top:1px solid rgba(255,255,255,.55); border-bottom:1px solid rgba(255,255,255,.55) }
.master-table tbody td:first-child{ border-top-left-radius:10px; border-bottom-left-radius:10px }
.master-table tbody td:last-child{ border-top-right-radius:10px; border-bottom-right-radius:10px }
.th-head{ position:relative; display:flex; align-items:center; justify-content:space-between; gap:6px; padding-right:12px }
.th-title{ font-weight:800; font-size:11px }
/* inline column menu removed; use modal instead */
.col-resize{ position:absolute; right:-3px; top:0; width:6px; height:100%; cursor:col-resize; opacity:0 }
.th-head:hover .col-resize{ opacity:1 }
.cell-editing{ background:#fff8e1 !important }
.pinned{ background:rgba(255,255,255,.96) !important; position:sticky; left:0; z-index:3; box-shadow:inset -1px 0 0 rgba(0,0,0,.06) }
.master-toolbar{ display:flex; align-items:center; gap:8px }
.widget-toolbar{display:flex; align-items:center; justify-content:space-between; gap:8px; margin:0 0 12px}
.widget-toolbar .left{display:flex; align-items:center; gap:8px}
.widget-grid{ 
  display:grid; 
  /* Fixed track size; wraps by reducing number of columns */
  grid-template-columns: repeat(auto-fit, var(--widget-col, 160px));
  grid-auto-rows: var(--widget-row, 160px); /* fixed block height */
  grid-auto-flow: dense; /* pack like iOS */
  gap:16px; 
  align-items:start; /* prevent stretch-induced growth */
  align-content:start; 
}

/* Polished widget card: adds smooth size transition */
.widget-card{
  position:relative; border-radius:24px; padding:16px; background:rgba(255,255,255,0.52);
  border:1px solid rgba(255,255,255,0.6); backdrop-filter:saturate(180%) blur(16px);
  box-shadow: 0 14px 42px rgba(31,35,70,.16);
  display:flex; flex-direction:column; gap:10px;
  transition: transform .16s ease, box-shadow .16s ease;
  will-change: transform, box-shadow;
  overflow:hidden;
  height:100%;            /* fill grid track height */
  max-height:100%;        /* clamp */
  min-height:0;           /* allow internal content to shrink */
}
.widget-card:hover{ transform: translateY(-1px); box-shadow: 0 18px 48px rgba(31,35,70,.18); }
.widget-card .widget-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:4px }
.widget-title{ display:flex; align-items:center; gap:6px; font-weight:700; font-size:12px }
.widget-glyph{ width:14px; height:14px; stroke:var(--outline); fill:none; stroke-width:var(--icon-stroke) }
.widget-actions{ display:flex; align-items:center; gap:6px }
.widget-actions{ opacity:0; pointer-events:none; transition: opacity .12s ease }
body.widgets-editing .widget-actions{ opacity:1; pointer-events:auto }
.mini-btn{ border:1px solid #e7e7f3; background:#fff; padding:4px 8px; border-radius:8px; cursor:pointer; font-weight:700; font-size:11px; box-shadow:0 2px 8px rgba(31,35,70,.10); }

.widget-card .delete-btn{ color:#cc3a3a; }
.widget-body{ flex:1; display:flex; flex-direction:column; gap:6px; min-height:0; overflow-y:auto; overflow-x:hidden; font-size:9px; line-height:1.35 }
/* Make widget charts truly responsive within fixed blocks */
.widget-card .chart-box{ position:relative; width:100%; height:100%; min-height:0; flex:1 }
.widget-card canvas{ width:100% !important; height:100% !important; display:block }
/* Smaller widget-specific typography */
.widget-card .mini-list{ font-size:10px }
.widget-card .kpi-value{ font-size:20px; font-weight:800 }
.widget-card .weather .temp{ font-size:24px }

/* chip-styled quick links */
.links-wrap{ display:flex; flex-wrap:wrap; gap:10px }
.links-wrap .link{
  display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px;
  border:1px solid rgba(255,255,255,0.55); background:rgba(255,255,255,0.6); text-decoration:none;
  box-shadow:0 2px 10px rgba(31,35,70,.10);
}
.links-wrap .link:hover{ background:rgba(255,255,255,0.75); box-shadow:0 6px 18px rgba(31,35,70,.14) }

/* Requested widget proportions:
   XS=1x1, S=2x1, M=2x2, L=2x3, XL=2x4, XXL=3x3 */
.widget-card.size-xs{ grid-column: span 1; grid-row: span 1; }
.widget-card.size-s { grid-column: span 2; grid-row: span 1; }
.widget-card.size-m { grid-column: span 2; grid-row: span 2; }
.widget-card.size-l { grid-column: span 2; grid-row: span 3; }
.widget-card.size-xl{ grid-column: span 2; grid-row: span 4; }
.widget-card.size-xxl{ grid-column: span 3; grid-row: span 3; }

/* Orientation-aware overrides for rectangular sizes */
.widget-card.size-s.orient-portrait  { grid-column: span 1; grid-row: span 2; } /* 1x2 */
.widget-card.size-s.orient-landscape { grid-column: span 2; grid-row: span 1; } /* 2x1 */

.widget-card.size-l.orient-portrait  { grid-column: span 2; grid-row: span 3; } /* 2x3 */
.widget-card.size-l.orient-landscape { grid-column: span 3; grid-row: span 2; } /* 3x2 */

.widget-card.size-xl.orient-portrait  { grid-column: span 2; grid-row: span 4; } /* 2x4 */
.widget-card.size-xl.orient-landscape { grid-column: span 4; grid-row: span 2; } /* 4x2 */

/* Orientation visual hooks (no-op unless you style them) */
.widget-card.orient-portrait  { --orient: portrait; }
.widget-card.orient-landscape { --orient: landscape; }

/* Jiggle (edit mode) */
.widget-grid.is-editing .widget-card{ animation: jiggle var(--widget-jiggle-speed) ease-in-out infinite; cursor:grab; transform-origin: 50% 55%; }
.widget-grid.is-editing .widget-card:active{ cursor:grabbing }
@keyframes jiggle {
  0% { transform: rotate(calc(var(--widget-jiggle-rot) * -1)) }
  50% { transform: rotate(var(--widget-jiggle-rot)) }
  100% { transform: rotate(calc(var(--widget-jiggle-rot) * -1)) }
}

/* Subtle snap on drop (iOS-like) */
.widget-card.snap { animation: widget-snap .18s ease-out; }
@keyframes widget-snap { from { transform: scale(.98); } to { transform: scale(1); } }

body[data-jiggle="soft"]{
  --widget-jiggle-rot: 0.22deg;
  --widget-jiggle-speed: .5s;
}
@media (prefers-reduced-motion: reduce){
  .widget-grid.is-editing .widget-card{ animation: none; }
}

/* Widget Settings Popover (soft glass, iOS-like) */
.widget-pop{
  position:absolute; top:46px; right:10px; z-index:50; min-width:220px; max-width:280px;
  padding:12px; border-radius:14px;
  background:linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.6));
  backdrop-filter:saturate(180%) blur(16px);
  border:1px solid rgba(255,255,255,0.55);
  box-shadow:0 12px 30px rgba(31,35,70,.18);
}
.widget-pop::before{
  content:""; position:absolute; top:-8px; right:24px; width:12px; height:12px; transform:rotate(45deg);
  background:inherit; border-left:1px solid rgba(255,255,255,0.55); border-top:1px solid rgba(255,255,255,0.55);
  filter:blur(.2px);
}
.widget-pop .pop-head{
  font-weight:800; font-size:13px; margin-bottom:8px; letter-spacing:.2px;
}
.widget-pop .pop-row{ display:grid; gap:6px; font-size:12px; color:var(--muted); margin:10px 0 }
.widget-pop select,
.widget-pop input[type="text"]{
  width:100%; padding:8px 10px; border-radius:10px; border:1px solid #e7e7f3;
  background:#fff; color:var(--text); outline:none;
  box-shadow:0 2px 10px rgba(31,35,70,.08);
}
.widget-pop select:focus,
.widget-pop input[type="text"]:focus{
  box-shadow:0 0 0 4px var(--ring), 0 2px 10px rgba(31,35,70,.08);
  border-color:transparent;
}
.widget-pop .pop-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:8px }
.widget-pop .mini-btn{ font-size:12px }

/* Mini list for compact widgets */
.mini-list{ list-style:none; padding:0; margin:0; display:grid; gap:6px; font-size:13px }
.mini-list li{
  background:rgba(255,255,255,0.6);
  border:1px solid rgba(255,255,255,0.55);
  border-radius:12px; padding:8px;
  box-shadow:0 2px 10px rgba(31,35,70,.10);
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
}
.mini-list li:hover{
  transform: translateY(-1px);
  background:rgba(255,255,255,0.72);
  box-shadow:0 6px 18px rgba(31,35,70,.14);
}

/* Toasts */
#toastContainer{ position: fixed; bottom: 16px; right: 16px; display:grid; gap:8px; z-index: 99999 }
.toast{ padding:10px 12px; border-radius:12px; background:#fff; border:1px solid rgba(255,255,255,0.55); box-shadow:0 10px 30px rgba(31,35,70,.14); font-size:13px; font-weight:700 }
.toast.info{ border-color:#e7e7f3 }
.toast.success{ border-color:#c8f5dc }
.toast.error{ border-color:#ffd4d4; color:#b42323 }
.toast small{ display:block; font-weight:600; color:var(--muted) }

/* KPI + Weather + Links */
.kpi-wrap{ display:flex; flex-direction:column; gap:4px; margin-top:4px }
.kpi-value{ font-size:28px; font-weight:800 }
.calc{ display:flex; gap:8px; align-items:center }
.calc input, .calc select{ padding:6px; border:1px solid #e7e7f3; border-radius:10px }
.weather{ display:flex; flex-direction:column; gap:6px; align-items:flex-start; justify-content:center; height:100% }
.weather .temp{ font-size:36px; font-weight:800 }

/* Bottom sheet (Widget Gallery) */
.sheet{ position:fixed; inset:0; display:grid; grid-template-rows: 1fr auto; pointer-events:none; }
.sheet[aria-hidden="true"]{ display:none }
.sheet .sheet-scrim{ grid-row:1; background:rgba(0,0,0,.18); opacity:1; }
.sheet-panel{
  grid-row:2; background:linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.6));
  backdrop-filter:saturate(160%) blur(18px); border-top-left-radius:20px; border-top-right-radius:20px;
  border:1px solid rgba(255,255,255,0.45);
  box-shadow:0 -10px 30px rgba(31,35,70,.15);
  pointer-events:auto;
}
.sheet-header{ position:relative; display:flex; align-items:center; justify-content:center; padding:12px }
.sheet-drag-handle{ width:46px; height:5px; border-radius:999px; background:#d0d3e6 }
.sheet-header h3{ margin:0; font-size:14px; font-weight:800 }
.sheet-header .icon-btn{ position:absolute; right:12px; top:8px }
.sheet-content{ padding:12px 16px 18px }
.widget-gallery{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px }
.gallery-item{
  display:flex; flex-direction:column; align-items:center; gap:6px; padding:10px;
  border-radius:14px; border:1px solid rgba(255,255,255,0.45); background:#fff; cursor:pointer;
  box-shadow:0 6px 16px rgba(31,35,70,.12);
  font-weight:700;
}
.gallery-item .glyph{ font-size:20px }

/* Editing badge next to Edit button */
.edit-badge{
  display:inline-flex; align-items:center; gap:6px;
  height:28px; padding:0 10px; border-radius:999px; font-size:12px; font-weight:800;
  color:#12131a; background:#ffffff; border:var(--line) var(--outline-style, solid) var(--outline);
  box-shadow:calc(var(--shadow-offset)/2) calc(var(--shadow-offset)/2) 0 rgba(18,19,26,.15);
  opacity:0; pointer-events:none; transition:opacity .15s ease, transform .15s ease;
  transform:translateY(2px);
}
body.widgets-editing .edit-badge{ opacity:1; pointer-events:auto; transform:translateY(0) }

/* Gallery sections */
.gallery-section{ margin-bottom:12px }
.gallery-section h4{
  margin:6px 4px; font-size:12px; font-weight:800; color:var(--muted); letter-spacing:.2px;
}
.widget-gallery .glyph{ width:18px; height:18px; stroke:var(--outline); fill:none; stroke-width:var(--icon-stroke) }

/* --- Widget polish additions --- */

/* Accessibility helper (for aria-live messages) */
.visually-hidden {
  position:absolute !important;
  height:1px; width:1px;
  overflow:hidden; clip:rect(1px,1px,1px,1px);
  white-space:nowrap; border:0; padding:0; margin:-1px;
}

/* Edit mode cues */
body.widgets-editing .widget-card { cursor:grab; }
body.widgets-editing .widget-card:active { cursor:grabbing; }
.widget-card.dragging { opacity:.6; }

/* Placeholder shown while dragging */
.widget-placeholder{
  border:1.5px dashed rgba(18,19,26,.35);
  border-radius:22px;
  background:rgba(255,255,255,0.25);
  box-shadow: 0 8px 24px rgba(31,35,70,.12) inset;
  grid-column: span 1;
  grid-row: span 1;
}
/* Placeholder orientation variants via classes */
.widget-placeholder.size-s.orient-portrait { grid-column: span 1; grid-row: span 2; }
.widget-placeholder.size-s.orient-landscape{ grid-column: span 2; grid-row: span 1; }
.widget-placeholder.size-l.orient-portrait { grid-column: span 2; grid-row: span 3; }
.widget-placeholder.size-l.orient-landscape{ grid-column: span 3; grid-row: span 2; }
.widget-placeholder.size-xl.orient-portrait { grid-column: span 2; grid-row: span 4; }
.widget-placeholder.size-xl.orient-landscape{ grid-column: span 4; grid-row: span 2; }
/* Placeholder orientation variants via data attributes (alternative hook) */
.widget-placeholder[data-size="s"][data-orient="portrait"]  { grid-column: span 1; grid-row: span 2; }
.widget-placeholder[data-size="s"][data-orient="landscape"] { grid-column: span 2; grid-row: span 1; }
.widget-placeholder[data-size="l"][data-orient="portrait"]  { grid-column: span 2; grid-row: span 3; }
.widget-placeholder[data-size="l"][data-orient="landscape"] { grid-column: span 3; grid-row: span 2; }
.widget-placeholder[data-size="xl"][data-orient="portrait"] { grid-column: span 2; grid-row: span 4; }
.widget-placeholder[data-size="xl"][data-orient="landscape"]{ grid-column: span 4; grid-row: span 2; }

/* Widget header/buttons polish */
.widget-head .widget-title { font-weight:800; letter-spacing:.2px }
.widget-actions .mini-btn { transition: transform .12s ease, box-shadow .12s ease }
.widget-actions .mini-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(31,35,70,.12) }
.widget-actions .mini-btn:focus-visible { outline:none; box-shadow:0 0 0 4px var(--ring) }

/* Active state for edit button */
.icon-btn.active { box-shadow:0 0 0 4px var(--ring), 0 6px 18px rgba(31,35,70,.14); }
.icon-btn:disabled { opacity:.45; cursor:not-allowed; box-shadow:none }

/* Sidebar gallery panel (replaces nav while open) */
.sidebar-gallery{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.72)); backdrop-filter:saturate(160%) blur(8px); border:1px solid rgba(255,255,255,0.45); border-radius:16px; box-shadow:0 12px 36px rgba(31,35,70,.16); padding:14px; overflow:auto }
.sidebar-gallery.is-hidden{ display:none }
.sidebar-gallery-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px }
.sidebar-gallery-head h3{ margin:0; font-size:14px; font-weight:800 }
.sidebar-gallery-content{ display:flex; flex-direction:column; gap:12px }

body.widgets-gallery-open .sidebar .nav,
body.widgets-gallery-open .sidebar .nav-subgroup,
body.widgets-gallery-open .sidebar .sidebar-footer{ display:none }

/* Config sidebar (columns) */
body.config-open .sidebar .nav,
body.config-open .sidebar .nav-subgroup,
body.config-open .sidebar .sidebar-footer{ display:none }


/* Sidebar gallery item polish */
.sidebar-gallery .widget-gallery{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px }
.sidebar-gallery .gallery-item{ display:flex; align-items:center; gap:8px; justify-content:flex-start; padding:12px; border-radius:14px; border:1px solid #eaeaf5; background:#fff; box-shadow:0 6px 16px rgba(31,35,70,.10); font-weight:800 }
.sidebar-gallery .gallery-item .glyph{ width:18px; height:18px }
.sidebar-gallery h4{ margin:6px 4px 4px; font-size:12px; letter-spacing:.2px; color:#6b708c; font-weight:800 }

/* Responsive tuning */
@media (max-width: 1100px){
  /* Preserve fixed widget block sizes; only adjust gallery grid */
  .widget-gallery{ grid-template-columns: repeat(3, 1fr) }
}
@media (max-width: 700px){
  /* Keep widget track size fixed; wrapping occurs by reducing column count */
  /* No span overrides here */
  .widget-gallery{ grid-template-columns: repeat(2, 1fr) }
}
/* Direct size picker (injected by JS as #widgetSizeMenu) */
#widgetSizeMenu{
  font-family: inherit;
}
#widgetSizeMenu button{
  font-weight:700; border-radius:10px;
}
#widgetSizeMenu button:hover,
#widgetSizeMenu button:focus-visible{
  outline:none;
  background:#f4f1ff;
}

/* Settings caret + compact rows */
#widgetSettingsMenu{ position:absolute; }
#widgetSettingsMenu::after{ content:""; position:absolute; width:12px; height:12px; background:#fff; border:1px solid #e7e7f3; transform:rotate(45deg); box-shadow:0 2px 8px rgba(31,35,70,.08) }
#widgetSettingsMenu[data-caret="up"]::after{ top:-7px; left:20px }
#widgetSettingsMenu[data-caret="down"]::after{ bottom:-7px; left:20px }

/* Widget internals: Notes, Calculator, Lists */
.notes-area{ width:100%; min-height:120px; padding:10px 12px; border:1px solid #e7e7f3; border-radius:14px; resize:vertical; background:rgba(255,255,255,0.7); }
.notes-area:focus{ outline:none; box-shadow:0 0 0 4px var(--ring); border-color:transparent }

/* Calculator keypad UI */
.calc{ display:grid; grid-template-rows: auto 1fr; gap:10px }
.calc-display{ font-weight:800; font-size:20px; text-align:right; padding:10px 12px; border:1px solid #e7e7f3; border-radius:12px; background:#fff; box-shadow:0 2px 8px rgba(31,35,70,.06) }
.calc-pad{ display:grid; grid-template-columns: repeat(4, 1fr); gap:8px }
.calc-btn{ padding:10px; border-radius:12px; border:1px solid #e7e7f3; background:#fff; font-weight:800; cursor:pointer; box-shadow:0 2px 8px rgba(31,35,70,.06) }
.calc-btn.op{ background:#f6f2ff }
.calc-btn.eq{ background:#ece5ff; border-color:#d9d3ff }
.calc-btn:active{ transform:translateY(1px) }

.mini-list{ list-style:none; padding:0; margin:0; display:grid; gap:6px }
.mini-list li{ background:rgba(255,255,255,0.65); border:1px solid rgba(255,255,255,0.55); border-radius:10px; padding:8px 10px }

/* Compact widget typography & chart size */
.widget-card .kpi-value{ font-size:26px; font-weight:800 }
.widget-card .chart-box{ height:140px }

/* Unified look for widget settings popover */
#widgetSettingsMenu{ font-family: inherit; }
#widgetSettingsMenu .settings-head{ display:flex; align-items:center; justify-content:space-between; margin:2px 2px 8px }
#widgetSettingsMenu .settings-row{ display:grid; grid-template-columns: 120px 1fr auto; gap:10px; align-items:center; padding:8px 2px }
#widgetSettingsMenu .settings-row label{ font-size:12px; color:var(--muted); font-weight:800 }
#widgetSettingsMenu select, #widgetSettingsMenu input{ width:100%; padding:8px 10px; border:1px solid #e7e7f3; border-radius:12px; font:inherit; background:#fff }
#widgetSettingsMenu .settings-actions{ display:flex; align-items:center; gap:8px; margin-top:10px }
#widgetSettingsMenu .mini-btn:disabled{ opacity:.5; cursor:not-allowed }
.sidebar-gallery#accent, .sidebar-gallery[data-accent]{ }
#colsConfigSide{ --cols-accent:#5a3fff; --cols-bg:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.78)); }
#colsConfigSide{ background:var(--cols-bg); border:1px solid rgba(90,63,255,.15) }
#colsConfigSide .sidebar-gallery-head h3{ color:#2b2366 }
#colsConfigSide .sidebar-gallery-head .mini-btn{ background:#fff; border:1px solid rgba(90,63,255,.22); box-shadow:0 4px 14px rgba(90,63,255,.14) }
#colsConfigSide .panel{ background:rgba(255,255,255,.92); border:1px solid rgba(90,63,255,.18); border-radius:16px; box-shadow:0 14px 30px rgba(90,63,255,.12) }
#colsConfigSide .cols-body{ display:flex; flex-direction:column; gap:10px; height:calc(100% - 48px) }
#colsConfigSide #colsSideList{ flex:1 1 48%; overflow:auto; padding:8px }
#colsConfigSide #colsSideEditor{ flex:1 1 52%; overflow:auto; padding:10px }

/* Column list items */
#colsSideList .col-item{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:12px; border:1px solid #eceaf9; background:#fff; box-shadow:0 8px 22px rgba(31,35,70,.08); cursor:grab }
#colsSideList .col-item + .col-item{ margin-top:8px }
#colsSideList .col-item .label{ font-weight:800; color:#2d2f45 }
#colsSideList .col-item .badges{ margin-left:auto; display:flex; gap:6px }
#colsSideList .badge{ font-size:10px; padding:2px 8px; border-radius:999px; background:#f0e9ff; color:#5a3fff; border:1px solid rgba(90,63,255,.25); font-weight:800 }
#colsSideList .col-item.is-active{ outline:2px solid rgba(90,63,255,.34); background:linear-gradient(180deg, #fff, #f8f6ff) }

/* Column editor vertical layout */
#colsSideEditor .kv{ margin-bottom:8px }
#colsSideEditor .panel{ box-shadow:0 12px 24px rgba(31,35,70,.10) }
#colsSideEditor .section-title{ font-size:12px; font-weight:900; color:#6b708c; margin:6px 0 2px }
#colsSideEditor .kv .val{ display:block }
#colsSideEditor .kv .val input, #colsSideEditor .kv .val select{
  padding:6px 8px; font-size:12px; width:100%; max-width:100%; box-sizing:border-box;
}

/* Header filter dropdown removed */
[data-subtab-panel="col-config"] .cfg-split{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; align-items:start }
[data-subtab-panel="col-config"] .cfg-row{ display:grid; grid-template-columns: 120px 1fr; gap:8px; align-items:center }
[data-subtab-panel="col-config"] .cfg-row input, [data-subtab-panel="col-config"] .cfg-row select{ width:100%; padding:6px 8px; border:1px solid #e7e7f3; border-radius:10px; background:#fff; font-size:12px }
[data-subtab-panel="col-config"] #cfgColsList .col-item{ display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid #eceaf9; border-radius:12px; background:#fff; box-shadow:0 6px 16px rgba(31,35,70,.08); cursor:grab }
[data-subtab-panel="col-config"] #cfgColsList .col-item + .col-item{ margin-top:6px }
[data-subtab-panel="col-config"] #cfgColsList .col-item.is-active{ outline:2px solid rgba(90,63,255,.34); background:linear-gradient(180deg,#fff,#f8f6ff) }
/* ===================== Service Tabs (from service_tabs.html) ===================== */
.btn{border:1px solid var(--outline); border-radius:10px; background:#fff; padding:8px 10px; cursor:pointer; font-weight:700; font-size:12px}
.btn.primary{ background:#6f5cff; border-color:#6f5cff; color:#fff }
.btn.warn{ background:#fff6e6; border-color:#ffd599; }
.btn.bad{ background:#ffeaea; border-color:#ffc9c9 }
.input{border:1px solid var(--outline); border-radius:10px; background:#fff; padding:8px 10px}
.badge{display:inline-flex; align-items:center; gap:6px; padding:3px 8px; border-radius:999px; background:#f0e9ff; border:1px solid #ece7ff; font-size:11px; font-weight:800}
.chip{display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; background:#f7f7ff; border:1px solid var(--outline); font-size:12px; font-weight:800}
.kanban{display:grid;grid-template-columns:repeat(5,minmax(220px,1fr));gap:12px}
.kcol{display:flex;flex-direction:column;min-height:50vh;background:#fff;border:1px solid var(--outline);border-radius:16px; box-shadow:0 10px 26px rgba(31,35,70,.10)}
.khead{padding:8px 10px;border-bottom:1px solid var(--outline);font-weight:800;color:#5a3fff}
.kbody{padding:10px;display:grid;gap:12px;min-height:120px}
.kcard{background:#fff;border:1px solid var(--outline);border-radius:12px;padding:12px;box-shadow:0 14px 30px rgba(31,35,70,.10)}
.kcard .top{display:flex; align-items:center; justify-content:space-between; font-weight:900}
.kcard .meta{color:var(--muted); font-size:12px; margin-top:2px}
.kcard .actions{display:flex; gap:8px; margin-top:8px}
.kmeta{color:var(--muted);font-size:12px;margin-top:2px}
.kchips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.review{display:grid;grid-template-columns:320px 1fr;gap:12px}
.review .panel{ box-shadow:0 12px 30px rgba(31,35,70,.10) }
.review .panel-header{ align-items:center }
.review-toolbar{ display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px }
.review .list{ display:grid; gap:8px }
.review .list .rItem{ cursor:pointer }
.rItem{display:grid;grid-template-columns:18px 1fr;gap:8px;align-items:center;padding:8px 10px;border:1px solid var(--outline);border-radius:12px;background:#fff}
.kvM{display:grid;grid-template-columns:140px 1fr;gap:6px;margin-bottom:6px}
.tableS{width:100%;border-collapse:collapse}.tableS th,.tableS td{border:1px solid var(--outline);padding:6px 8px;font-size:12px}
.tm-grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
.tm-thread{border:1px solid var(--outline);border-radius:12px;padding:10px;display:grid;gap:8px;max-height:50vh;overflow:auto;background:#fafafb}
.msg{background:#fff;border:1px solid #eaeaf3;border-radius:10px;padding:8px}
.msg.tech{border-color:#ffe1c7;background:#fff9f3}.msg.sales{border-color:#d8f1e5;background:#f6fffb}.msg.me{border-color:#d7defe;background:#f2f6ff}
.sml{font-size:12px;color:var(--muted)}
.tableP{width:100%;border-collapse:collapse}.tableP th,.tableP td{border:1px solid var(--outline);padding:8px}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
#inv-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);z-index:10000}
#inv-modal.show{display:flex}
.inv-card{background:#fff;border:1px solid var(--outline);border-radius:16px;max-width:1000px;width:min(95vw,1000px);max-height:90vh;overflow:auto;padding:18px 20px;box-shadow:0 24px 60px rgba(0,0,0,.22)}
.inv-close{border:1px solid var(--outline);background:#fff;border-radius:10px;cursor:pointer;padding:6px 10px}
@media(max-width:980px){.review{grid-template-columns:1fr}.tm-grid{grid-template-columns:1fr}}


/* ================================
   Service subtabs  soft-glass add-ons
   (append to end of styles.css)
   ================================= */

/* Diff badges in Billing (formerly Review) */
.badge.changed {
  background:#fff7ed;
  border:1px solid #ffd6a6;
  color:#7a4b00;
}

/* Hide unchanged rows when "Show changes only" is on */
.kvM.hide { display:none }

/* Undo banner */
#undoBar{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:24px;
  background:#fff;
  border:1px solid var(--outline);
  border-radius:999px;
  box-shadow:0 8px 24px rgba(0,0,0,.12);
  padding:8px 12px;
  display:none;
  gap:8px;
  align-items:center;
  z-index:12000;
}
#undoBar.show{ display:flex }

/* Inline invoice modal (shared by Billing) */
#inv-modal{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(4px);
  z-index:10000;
}
#inv-modal.show{ display:flex }
.inv-card{
  background:#fff;
  border:1px solid var(--outline);
  border-radius:16px;
  max-width:1000px;
  width:min(95vw,1000px);
  max-height:90vh;
  overflow:auto;
  padding:18px 20px;
  box-shadow:0 24px 60px rgba(0,0,0,.22);
}
.inv-close{
  border:1px solid var(--outline);
  background:#fff;
  border-radius:10px;
  cursor:pointer;
  padding:6px 10px;
}

/* WIP: keyboard focus + drag highlights */
.kcard:focus{ outline:3px solid var(--ring) }
.kbody.drop-hot{ box-shadow: inset 0 0 0 3px var(--ring) }
.kcol.drag-hot{ box-shadow: inset 0 0 0 3px var(--ring) }

/* Slack Composer (soft-glass) */
#slack-modal{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(4px);
  z-index:10001;
}
#slack-modal.show{ display:flex }
/* Reuse .inv-card look for composer content */
