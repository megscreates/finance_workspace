<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crystal Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@400;600;700&family=DM+Sans:wght@400;600;700&family=Space+Grotesk:wght@400;600;700&family=Karla:wght@400;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Charts via CDN (no local install required) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body data-look="glass">
  <div id="widgetsLive" class="visually-hidden" aria-live="polite"></div>
  <!-- Inline SVG icon sprite -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
    <symbol id="i-home" viewBox="0 0 24 24">
      <path d="M3 10.5 12 3l9 7.5V21a1.5 1.5 0 0 1-1.5 1.5H4.5A1.5 1.5 0 0 1 3 21Z" fill="none" stroke="currentColor"
        stroke-width="2" />
      <path d="M9 22V13h6v9" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-report" viewBox="0 0 24 24">
      <rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M8 16V10M12 16V8M16 16v-4" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-growth" viewBox="0 0 24 24">
      <path d="M4 20V10l4 3 6-7 6 5" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M20 20H4" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-stats" viewBox="0 0 24 24">
      <path d="M4 20V8m5 12V4m5 16v-8m5 8v-5" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-mail" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M3 7l9 6 9-6" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-settings" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2" />
      <path
        d="M19.4 15a7.8 7.8 0 0 0 .1-2l2-1.5-2-3.4-2.3.7a7.8 7.8 0 0 0-1.7-1l-.3-2.4H10.8l-.3 2.4a7.8 7.8 0 0 0-1.7 1l-2.3-.7-2 3.4L6.5 13a7.8 7.8 0 0 0 .1 2l-2 1.5 2 3.4 2.3-.7a7.8 7.8 0 0 0 1.7 1l.3 2.4h3.6l.3-2.4a7.8 7.8 0 0 0 1.7-1l2.3.7 2-3.4Z"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
    </symbol>
    <symbol id="i-life" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M12 3v6m0 6v6m9-9h-6M9 12H3" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-money" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M9 10.5c0-1.2 1.1-2 3-2s3 .8 3 2-1 1.8-3 2-3 .8-3 2 1.2 2 3 2 3-.8 3-2" fill="none" stroke="currentColor"
        stroke-width="2" />
    </symbol>
    <symbol id="i-tag" viewBox="0 0 24 24">
      <path d="M3 12l9-9h6l3 3v6l-9 9-9-9Z" fill="none" stroke="currentColor" stroke-width="2" />
      <circle cx="17" cy="7" r="1.5" fill="currentColor" />
    </symbol>
    <symbol id="i-users" viewBox="0 0 24 24">
      <circle cx="9" cy="9" r="3" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M3 21a6 6 0 0 1 12 0" fill="none" stroke="currentColor" stroke-width="2" />
      <circle cx="17" cy="9" r="2" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M14 21a5 5 0 0 1 7 0" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="i-cart" viewBox="0 0 24 24">
      <path d="M3 5h2l2 12h10l2-8H7" fill="none" stroke="currentColor" stroke-width="2" />
      <circle cx="9" cy="20" r="1.5" />
      <circle cx="17" cy="20" r="1.5" />
    </symbol>
    <symbol id="i-palette" viewBox="0 0 24 24">
      <path d="M12 3a9 9 0 1 0 9 9c0-1.7-1.3-3-3-3h-1.5a2.5 2.5 0 0 1-2.5-2.5V6c0-1.7-1.3-3-3-3Z" fill="none"
        stroke="currentColor" stroke-width="2" />
      <circle cx="7.5" cy="10" r="1.2" />
      <circle cx="10.5" cy="14" r="1.2" />
      <circle cx="14.5" cy="12.5" r="1.2" />
      <circle cx="16" cy="8.5" r="1.2" />
    </symbol>
  </svg>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">⫷⫸</div>
        <span>Startup XYZ</span>
      </div>

      <nav class="nav">
        <a class="nav-item active" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-home" />
            </svg></span>
          <span>Home</span>
        </a>
        <div class="nav-subgroup" aria-label="Home subtabs">
          <!-- Dashboard handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="dash-tasks">Tasks</a>
          <a class="nav-subitem" data-subtab-jump="dash-messages">Messages</a>
          <a class="nav-subitem" data-subtab-jump="dash-calendar">Calendar</a>
          <a class="nav-subitem" data-subtab-jump="dash-reports" data-perm="viewReports"
            data-flag="advancedReporting">Reports</a>
          <a class="nav-subitem" data-subtab-jump="dash-search">Search</a>
        </div>


        <!-- Cash Flow moved after Payables -->
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-growth" />
            </svg></span>
          <span>Cash Flow</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Cash Flow subtabs">
          <!-- Dashboard handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="cf-ar">AR Overview</a>
          <a class="nav-subitem" data-subtab-jump="cf-ap">AP Overview</a>
          <a class="nav-subitem" data-subtab-jump="cf-forecast">Forecast</a>
          <a class="nav-subitem" data-subtab-jump="cf-transactions">Transactions</a>
          <a class="nav-subitem" data-subtab-jump="cf-requests">Requests</a>
          <a class="nav-subitem" data-subtab-jump="cf-tasks">Tasks</a>
          <a class="nav-subitem" data-subtab-jump="cf-reports" data-perm="viewReports"
            data-flag="advancedReporting">Reports</a>

        </div>
        <!-- Collections (new main section) -->
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-stats" />
            </svg></span>
          <span>Collections</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Collections subtabs">
          <!-- Overview handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="col-assign">Assignments</a>
          <a class="nav-subitem" data-subtab-jump="col-outgoing">Outgoing</a>
          <a class="nav-subitem" data-subtab-jump="col-risk">Risk Status</a>
          <a class="nav-subitem" data-subtab-jump="col-master">Master</a>
          <a class="nav-subitem" data-subtab-jump="col-config">Configuration</a>
        </div>
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-palette" />
            </svg></span>
          <span>Projects</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Projects subtabs">
          <!-- Overview handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="projects-poc">POC</a>
          <a class="nav-subitem" data-subtab-jump="projects-billing">Billing</a>
          <a class="nav-subitem" data-subtab-jump="projects-timeline">Timeline</a>
          <a class="nav-subitem" data-subtab-jump="projects-requests">Requests</a>
        </div>
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-settings" />
            </svg></span>
          <span>Service</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Service subtabs">
          <!-- Overview handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="service-wip">WIP</a>
          <a class="nav-subitem" data-subtab-jump="service-billing">Billing</a>
          <a class="nav-subitem" data-subtab-jump="service-review">Review</a>
          <a class="nav-subitem" data-subtab-jump="service-tm">T&amp;M</a>
          <a class="nav-subitem" data-subtab-jump="service-pricing">Pricing</a>
          <a class="nav-subitem" data-subtab-jump="service-requests">Requests</a>
        </div>
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-report" />
            </svg></span>
          <span>Compliance</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Compliance subtabs">
          <!-- Overview handled by main tab; removed from leftnav -->
          <a class="nav-subitem" data-subtab-jump="compliance-policies">Policies</a>
          <a class="nav-subitem" data-subtab-jump="compliance-audits">Audits</a>
        </div>
        <!-- Admin section -->
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-settings" />
            </svg></span>
          <span>Admin</span>
        </a>
        <div class="nav-subgroup is-hidden" aria-label="Admin subtabs">
          <a class="nav-subitem is-current" data-subtab-jump="admin-overview">Overview</a>
          <a class="nav-subitem" data-subtab-jump="admin-general">General</a>
          <a class="nav-subitem" data-subtab-jump="admin-roles" data-perm="manageUsers">Roles</a>
          <a class="nav-subitem" data-subtab-jump="admin-users" data-perm="manageUsers">Users</a>
          <a class="nav-subitem" data-subtab-jump="admin-perms" data-perm="manageConfigs">Permissions</a>
          <a class="nav-subitem" data-subtab-jump="admin-config" data-perm="manageConfigs">Config</a>
          <a class="nav-subitem" data-subtab-jump="admin-notify" data-perm="manageConfigs">Notifications</a>
          <a class="nav-subitem" data-subtab-jump="admin-templates" data-perm="manageConfigs">Templates</a>
          <a class="nav-subitem" data-subtab-jump="admin-validate" data-perm="manageConfigs">Validation</a>
          <a class="nav-subitem" data-subtab-jump="admin-audit">Audit</a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-settings" />
            </svg></span>
          <span>Settings</span>
        </a>
        <a class="nav-item" href="#">
          <span class="icon"><svg viewBox="0 0 24 24">
              <use href="#i-life" />
            </svg></span>
          <span>Support</span>
        </a>
      </div>

      <!-- Hidden sidebar gallery panel -->
      <div id="widgetGallerySide" class="sidebar-gallery is-hidden" aria-hidden="true" aria-label="Widget Gallery">
        <header class="sidebar-gallery-head">
          <h3>Widgets</h3>
          <button class="icon-btn" id="widgetGalleryClose" title="Close"><svg viewBox="0 0 24 24">
              <use href="#i-report" />
            </svg></button>
        </header>
        <div class="sidebar-gallery-content">
          <div class="gallery-section">
            <h4>Data</h4>
            <div class="widget-gallery">
              <button class="gallery-item" data-add-widget="kpi"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-stats" />
                </svg><span>KPI</span></button>
              <button class="gallery-item" data-add-widget="metrics"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-growth" />
                </svg><span>Metrics</span></button>
            </div>
          </div>
          <div class="gallery-section">
            <h4>Communication</h4>
            <div class="widget-gallery">
              <button class="gallery-item" data-add-widget="email"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-mail" />
                </svg><span>Email</span></button>
              <button class="gallery-item" data-add-widget="messages"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-mail" />
                </svg><span>Messages</span></button>
              <button class="gallery-item" data-add-widget="announcements"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-report" />
                </svg><span>Announcements</span></button>
            </div>
          </div>
          <div class="gallery-section">
            <h4>Productivity</h4>
            <div class="widget-gallery">
              <button class="gallery-item" data-add-widget="tasks"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-settings" />
                </svg><span>Tasks</span></button>
              <button class="gallery-item" data-add-widget="reminders"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-settings" />
                </svg><span>Reminders</span></button>
              <button class="gallery-item" data-add-widget="calendar"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-life" />
                </svg><span>Calendar</span></button>
              <button class="gallery-item" data-add-widget="notes"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-report" />
                </svg><span>Quick Notes</span></button>
            </div>
          </div>
          <div class="gallery-section">
            <h4>Utilities</h4>
            <div class="widget-gallery">
              <button class="gallery-item" data-add-widget="quicklinks"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-report" />
                </svg><span>Quick Links</span></button>
              <button class="gallery-item" data-add-widget="calculator"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-settings" />
                </svg><span>Calculator</span></button>
              <button class="gallery-item" data-add-widget="weather"><svg class="glyph" viewBox="0 0 24 24">
                  <use href="#i-life" />
                </svg><span>Weather</span></button>
            </div>
          </div>
        </div>
      </div>
      <!-- Hidden Columns Config panel (replaces nav when open) -->
      <div id="colsConfigSide" class="sidebar-gallery is-hidden" aria-hidden="true" aria-label="Column Settings">
        <header class="sidebar-gallery-head">
          <h3 style="display:flex; align-items:center; gap:8px"><svg class="glyph" viewBox="0 0 24 24"
              style="width:18px; height:18px">
              <use href="#i-settings" />
            </svg> Column Settings</h3>
          <button class="icon-btn" id="colsClose" title="Close"><svg viewBox="0 0 24 24">
              <use href="#i-report" />
            </svg></button>
        </header>
        <div class="cols-toolbar" style="display:flex; gap:8px; margin-bottom:8px">
          <button class="mini-btn" id="colsSwap">Swap</button>
          <button class="mini-btn" id="colsReset">Reset</button>
        </div>
        <div id="colsConfigContent" class="sidebar-gallery-content cols-body">
          <div id="colsSideList" class="panel"></div>
          <div id="colsSideEditor" class="panel"></div>
        </div>
      </div>
    </aside>

    <main class="content">
      <header class="topbar">
        <h1>Hello, <span class="gradient-text">Megs</span></h1>
        <div class="actions">
          <div class="search">
            <input id="globalSearch" placeholder="Search" />
          </div>

          <button class="icon-btn" title="Notifications"><svg viewBox="0 0 24 24">
              <use href="#i-life" />
            </svg></button>
          <div class="avatar" title="Profile">L</div>
        </div>
      </header>

      <nav class="subnav" role="tablist" aria-label="Home subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true" data-subtab="dash-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="dash-tasks">Tasks</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="dash-messages">Messages</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="dash-calendar">Calendar</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="dash-reports" data-perm="viewReports"
          data-flag="advancedReporting">Reports</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="dash-search">Search</button>
      </nav>

      <!-- Subtab panels (example for the Dashboard section) -->
      <section class="subtab-panel" data-subtab-panel="dash-overview">
        <div class="widget-toolbar">
          <div class="left">
            <button class="icon-btn" id="widgetsEditBtn" title="Customize Widgets">✎</button>
            <span class="edit-badge" id="widgetsEditBadge" aria-hidden="true">Editing</span>
          </div>
          <div class="right">
            <button class="icon-btn" id="widgetsAddBtn" title="Add Widget">＋</button>
          </div>
        </div>

        <section class="widget-grid" id="widgetGrid" aria-live="polite"></section>

        <!-- Sidebar Gallery (replaces left nav when adding widgets) -->

      </section>

      <!-- Dashboard: Tasks -->
      <section class="subtab-panel is-hidden" data-subtab-panel="dash-tasks">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>My Tasks</h2><span class="muted">Today</span>
          </div>
          <ul id="tasksList" style="list-style:none; padding:0; margin:0; display:grid; gap:8px"></ul>
        </div>
        <div class="panel">
          <div class="panel-header">
            <h2>Quick Add</h2>
          </div>
          <input id="taskInput" placeholder="Add a task and press Enter"
            style="width:100%; padding:10px; border-radius:10px; border:1px solid #e7e7f3" />
        </div>
      </section>

      <!-- Dashboard: Messages overview -->
      <section class="subtab-panel is-hidden" data-subtab-panel="dash-messages">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Messages</h2><span class="muted">Gmail • Chat • Slack</span>
          </div>
          <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap:16px">
            <div class="panel" data-service="gmail">
              <div class="panel-header">
                <h3>Gmail</h3>
              </div>
              <div class="service-content">
                <p class="muted">Connect your Google account to view inbox.</p>
                <button class="icon-btn" data-connect="gmail">Connect</button>
              </div>
            </div>
            <div class="panel" data-service="gchat">
              <div class="panel-header">
                <h3>Google Chat</h3>
              </div>
              <div class="service-content">
                <p class="muted">See recent threads and DMs.</p>
                <button class="icon-btn" data-connect="gchat">Connect</button>
              </div>
            </div>
            <div class="panel" data-service="slack">
              <div class="panel-header">
                <h3>Slack</h3>
              </div>
              <div class="service-content">
                <p class="muted">Unread channels and mentions.</p>
                <button class="icon-btn" data-connect="slack">Connect</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Dashboard: Calendar -->
      <section class="subtab-panel is-hidden" data-subtab-panel="dash-calendar">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Calendar</h2><span class="muted">Google Calendar</span>
          </div>
          <div id="calendarConnect">
            <p class="muted">Connect Google Calendar to show events.</p>
            <button class="icon-btn" data-connect="gcal">Connect</button>
          </div>
          <ul id="calendarList" style="list-style:none; padding:0; margin:12px 0 0; display:grid; gap:8px"></ul>
        </div>
      </section>

      <!-- Dashboard: Reports -->
      <section class="subtab-panel is-hidden" data-subtab-panel="dash-reports">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Reports</h2>
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px">
            <input id="reportName" placeholder="New report name"
              style="flex:1; padding:10px; border-radius:10px; border:1px solid #e7e7f3" />
            <button id="createReportBtn" class="icon-btn" title="Create">＋</button>
          </div>
          <ul id="reportsList" style="list-style:none; padding:0; margin:0; display:grid; gap:8px"></ul>
        </div>
      </section>

      <!-- Dashboard: Search -->
      <section class="subtab-panel is-hidden" data-subtab-panel="dash-search">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Global Search</h2>
          </div>
          <input id="dashSearch" placeholder="Search across data (orders, debtors, etc)"
            style="width:100%; padding:12px; border-radius:12px; border:1px solid #e7e7f3" />
          <p class="muted">Results update live across modules.</p>
          <div id="dashSearchResults" style="margin-top:12px; display:grid; gap:8px"></div>
        </div>
      </section>








      <!-- Cash Flow subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Cash Flow subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true" data-subtab="cf-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-ar">AR Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-ap">AP Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-forecast">Forecast</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-transactions">Transactions</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-requests">Requests</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-tasks">Tasks</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="cf-reports" data-perm="viewReports"
          data-flag="advancedReporting">Reports</button>

      </nav>
      <!-- Cash Flow panels (inlined) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="cf-overview">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Cash Flow Overview</h2>
          </div>
          <p class="muted">Loaded from partials/cashflow.html</p>
        </div>
      </section>



      <!-- Projects subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Projects subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true"
          data-subtab="projects-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="projects-poc">POC</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="projects-billing">Billing</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="projects-timeline">Timeline</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="projects-requests">Requests</button>
      </nav>
      <!-- Projects panels (inlined) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="projects-overview">
        <div class="panel">
          <div class="panel-header">
            <h2>Projects Overview</h2>
          </div>
          <p class="muted">Summary of project KPIs.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="projects-poc">
        <div class="panel">
          <div class="panel-header">
            <h2>Proof of Concept</h2>
          </div>
          <p class="muted">POC tracking.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="projects-billing">
        <div class="panel">
          <div class="panel-header">
            <h2>Billing</h2>
          </div>
          <p class="muted">Billing integration for projects.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="projects-timeline">
        <div class="panel">
          <div class="panel-header">
            <h2>Timeline</h2>
          </div>
          <p class="muted">Project schedules.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="projects-requests">
        <div class="panel">
          <div class="panel-header">
            <h2>Requests</h2>
          </div>
          <p class="muted">Incoming work requests.</p>
        </div>
      </section>

      <!-- Service subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Service subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true"
          data-subtab="service-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="service-wip">WIP</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="service-billing">Billing</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="service-tm">T&M</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="service-pricing">Pricing</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="service-requests">Requests</button>
      </nav>
      <!-- Service panels (inlined) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="service-overview">
        <div class="panel">
          <div class="panel-header">
            <h2>Service Overview</h2>
          </div>
          <p class="muted">High-level metrics.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-wip" id="svc-wip-panel">
        <div class="panel span-2">
          <div class="panel-header" style="align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px">
            <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap">
              <h2>WIP</h2>
              <input id="wip-search" class="input" placeholder="Search jobs, channels, scope…" style="width:320px" />
              <!-- Saved views -->
              <select id="view-select" class="input" title="Saved views">
                <option value="">Views…</option>
              </select>
              <input id="view-name" class="input" placeholder="New view name" style="width:160px" />
              <button class="btn" id="view-save">Save View</button>
              <button class="btn" id="view-del">Delete View</button>
            </div>

            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <button class="btn" id="wip-new">Simulate Slack Form</button>

              <!-- Bulk move -->
              <select id="wip-move-target" class="input" title="Bulk move filtered">
                <option value="Sales Review">Move filtered → Sales Review</option>
                <option value="Approved">Move filtered → Approved</option>
                <option value="Paid">Move filtered → Paid</option>
                <option value="Rejected">Move filtered → Rejected</option>
                <option value="Pending">Move filtered → Pending</option>
              </select>
              <button class="btn" id="wip-move">Go</button>

              <div class="badge">Drag cards &amp; columns • Use ←/→ to move</div>
            </div>
          </div>

          <!-- Kanban board (columns + cards render here) -->
          <div class="kanban" id="wip-board" role="list" aria-label="Work in progress lanes"></div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-billing" id="svc-review-panel">
        <div class="panel span-2">
          <div class="panel-header" style="align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px">
            <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap">
              <h2>Billing</h2>
              <input id="rev-search" class="input" placeholder="Filter…" style="width:320px" />
              <!-- Saved views -->
              <select id="revview-select" class="input" title="Saved views">
                <option value="">Views…</option>
              </select>
              <input id="revview-name" class="input" placeholder="New view" style="width:140px" />
              <button class="btn" id="revview-save">Save</button>
              <button class="btn" id="revview-del">Delete</button>
            </div>

            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <button class="btn" id="rev-apply-filtered">Apply edits → filtered</button>
              <button class="btn" id="rev-apply-selected">Apply edits → selected</button>
              <button class="btn" id="rev-compose">Compose to Slack</button>
              <button class="btn" id="rev-remind">Remind Selected</button>
              <label class="sml" style="display:flex; align-items:center; gap:6px">
                <input type="checkbox" id="rev-changes-only" /> Show changes only
              </label>
            </div>
          </div>

          <div class="review" style="display:grid; grid-template-columns:340px 1fr; gap:12px">
            <!-- Left list -->
            <div id="rev-list" class="panel" style="overflow:auto"></div>

            <!-- Right detail -->
            <div id="rev-detail" class="panel">
              <em>Select an invoice →</em>
            </div>
          </div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-tm" id="svc-tm-panel">
        <div class="panel span-2">
          <div class="panel-header" style="align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px">
            <h2>T&amp;M Hub</h2>
            <div class="badge">Slack Form Output &middot; Materials Issue CSV</div>
          </div>

          <div class="tm-grid" style="display:grid; grid-template-columns:1fr 320px; gap:12px">
            <!-- Left: entries table -->
            <div>
              <div class="panel-header"
                style="margin:0 0 8px 0; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px">
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                  <input id="tm-search" class="input" placeholder="Filter T&M entries…" style="width:280px" />
                  <button class="btn" id="tm-new">Simulate T&amp;M Entry</button>
                  <button class="btn" id="tm-compose">Compose to Slack</button>
                </div>
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                  <button class="btn primary" id="tm-export">Export Selected to CSV</button>
                  <span class="sml" id="tm-totals">—</span>
                </div>
              </div>

              <table class="tableP" id="tm-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="tm-all" /></th>
                    <th>Ticket</th>
                    <th>Channel</th>
                    <th>Techs</th>
                    <th>Drive</th>
                    <th>Labor</th>
                    <th>Materials</th>
                    <th>Scope</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td colspan="8" id="tm-footer" class="sml">Totals: —</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- Right: thread + activity -->
            <div>
              <div class="panel">
                <h3 style="margin:0 0 8px">Slack Thread</h3>
                <div class="tm-thread" id="tm-thread"></div>
                <div style="display:grid; gap:8px; margin-top:8px">
                  <textarea id="tm-msg" class="input" rows="3" placeholder="Post a message to thread…"></textarea>
                  <div style="display:flex; gap:8px; flex-wrap:wrap">
                    <button class="btn" id="tm-post">Send</button>
                    <button class="btn" id="tm-ask">Ask for Info</button>
                    <button class="btn" id="tm-approve">Simulate Approval</button>
                    <button class="btn" id="tm-reject">Simulate Reject</button>
                  </div>
                </div>
              </div>

              <div class="panel">
                <h3 style="margin:0 0 8px">Activity</h3>
                <div id="tm-feed" class="feed"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-pricing" id="svc-pricing-panel">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Pricing</h2>
          </div>

          <!-- Materials -->
          <div class="panel">
            <h3>Material Price List</h3>
            <table class="tableP" id="mat-table">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>Description</th>
                  <th>Price</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap">
              <input id="mat-sku" class="input mono" placeholder="SKU" />
              <input id="mat-desc" class="input" placeholder="Description" />
              <input id="mat-price" class="input mono" type="number" step="0.01" placeholder="Price" />
              <button class="btn" id="mat-add">Add/Update</button>
            </div>
          </div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-rules" id="svc-rules-panel">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Billing Rules</h2>
            <div class="muted">Per-customer / per-rep overrides; “*” matches any SKU.</div>
          </div>

          <div class="panel">
            <table class="tableP" id="rule-table">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Key</th>
                  <th>SKU</th>
                  <th>Price</th>
                  <th>Labor/hr</th>
                  <th>Drive/hr</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <div style="display:grid; grid-template-columns:120px 1fr 120px 120px 120px auto; gap:8px; margin-top:8px">
              <select id="rule-type" class="input">
                <option value="customer">Customer</option>
                <option value="rep">Sales Rep</option>
              </select>
              <input id="rule-key" class="input" placeholder="Acme Corp or @rep" />
              <input id="rule-sku" class="input mono" placeholder="SKU or *" />
              <input id="rule-price" class="input mono" type="number" step="0.01" placeholder="Price" />
              <input id="rule-labor" class="input mono" type="number" step="0.01" placeholder="Labor/hr" />
              <input id="rule-drive" class="input mono" type="number" step="0.01" placeholder="Drive/hr" />
              <button class="btn" id="rule-add">Add Rule</button>
            </div>

            <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap">
              <button class="btn" id="pricing-save">Save</button>
              <button class="btn" id="pricing-load">Load</button>
              <button class="btn bad" id="pricing-reset">Reset</button>
            </div>
          </div>
        </div>
      </section>
      <!-- Inline Invoice Modal for Service Tabs -->
      <div id="inv-modal">
        <div class="inv-card"><button class="inv-close">✕</button>
          <div id="inv-body"></div>
        </div>
      </div>
      <section class="subtab-panel is-hidden" data-subtab-panel="service-requests">
        <div class="panel">
          <div class="panel-header">
            <h2>Requests</h2>
          </div>
          <p class="muted">Incoming tickets.</p>
        </div>
      </section>

      <!-- Compliance subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Compliance subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true"
          data-subtab="compliance-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="compliance-policies">Policies</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="compliance-audits">Audits</button>
      </nav>
      <!-- Compliance panels (inlined) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="compliance-overview">
        <div class="panel">
          <div class="panel-header">
            <h2>Compliance Overview</h2>
          </div>
          <p class="muted">Loaded from partials/compliance.html</p>
        </div>
      </section>

      <!-- Collections subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Collections subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true" data-subtab="col-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="col-assign">Assignments</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="col-outgoing">Outgoing</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="col-risk">Risk Status</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="col-master">Master</button>
      </nav>
      <!-- Collections: Overview placeholder (focus on Master) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-overview">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>AR Collections</h2><span class="muted">Overview coming soon</span>
          </div>
          <p class="muted" style="padding:10px">We’re focusing on the Master table. This section will return with
            summaries once Master is finalized.</p>
        </div>
      </section>
      <!-- Collections: Assignments -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-assign">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Assignments</h2><span class="muted">Workload by collector</span>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Collector</th>
                  <th>Open Invoices</th>
                  <th>Total Open</th>
                  <th>Overdue</th>
                  <th>Promised</th>
                </tr>
              </thead>
              <tbody id="colAssignBody">
                <tr>
                  <td class="muted" colspan="5">Coming soon — assignment breakdown</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
      <!-- Collections: Outgoing -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-outgoing">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Outgoing</h2><span class="muted">Emails, calls, reminders</span>
          </div>
          <div style="display:grid; gap:10px">
            <div class="panel">
              <div class="panel-header">
                <h3>Today</h3>
              </div>
              <p class="muted">No scheduled messages.</p>
            </div>
            <div class="panel">
              <div class="panel-header">
                <h3>Queue</h3>
              </div>
              <p class="muted">Queue and batching rules will appear here.</p>
            </div>
          </div>
        </div>
      </section>
      <!-- Collections: Risk Status -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-risk">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Risk Status</h2><span class="muted">Signals and thresholds</span>
          </div>
          <div style="display:grid; gap:10px">
            <div class="panel">
              <div class="panel-header">
                <h3>Signals</h3>
              </div>
              <p class="muted">Define risk signals like >60 days, dispute, credit limit, etc.</p>
            </div>
            <div class="panel">
              <div class="panel-header">
                <h3>Accounts by Risk</h3>
              </div>
              <p class="muted">Charts and lists will display here.</p>
            </div>
          </div>
        </div>
      </section>
      <!-- Collections: Master (Data Grid Source of Truth) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-master">
        <div class="panel span-2">
          <div class="panel-header" style="align-items:center; justify-content:space-between">
            <h2>Master Data</h2>
            <div class="master-toolbar">
              <input id="masterSearch" class="ar-input" placeholder="Search all columns" />
              <select id="masterView" class="ar-select" aria-label="Saved views"></select>
              <select id="masterDefaultView" class="ar-select" aria-label="Default view"></select>
              <label class="mini-toggle"><input type="checkbox" id="masterAliasGlobalToggle" /> Use Aliases</label>
              <label class="mini-toggle">Aged On: <input type="date" id="masterAgedOn" /></label>
              <button class="mini-btn" id="masterSaveView">Save View</button>
              <button class="mini-btn" id="masterSaveViewAs">Save As…</button>
              <label class="mini-toggle"><input type="checkbox" id="masterDetailsToggle" /> Details</label>
              <button class="mini-btn" id="masterConfigureBtn">Configure</button>
            </div>
          </div>
          <div class="panel-body master-layout" id="masterBody">
            <div style="grid-area:grid">
              <div id="masterQuickFilters" class="tags" style="margin-bottom:8px"></div>
              <div id="masterGridWrap" class="table-wrap master-wrap">
                <table id="masterTable" class="table master-table" aria-label="Master data table"></table>
              </div>
            </div>
            <aside id="masterDetail" class="glass ar-detail is-hidden" style="grid-area:detail">
              <div class="glass-header" style="align-items:center">
                <div class="widget-title" id="mdTitle" style="font-weight:900">Select a row</div>
              </div>
              <div class="ar-meta-grid ar-meta-2col" id="mdBody"></div>
            </aside>
          </div>

          <!-- Columns modal -->
          <div id="masterColsModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="colsTitle">
            <div class="modal-backdrop" data-close-modal></div>
            <div class="modal-panel panel" style="width:860px; max-width:calc(100vw - 40px)">
              <div class="panel-header">
                <h3 id="colsTitle">Column Settings</h3>
                <div><button class="mini-btn" data-close-modal>Close</button></div>
              </div>
              <div class="panel-body"
                style="display:grid; grid-template-columns: 260px 1fr; gap:12px; align-items:start">
                <div>
                  <div style="display:flex; gap:6px; margin-bottom:6px">
                    <button class="mini-btn" id="colsMoveUp">Up</button>
                    <button class="mini-btn" id="colsMoveDown">Down</button>
                  </div>
                  <div id="colsList"
                    style="max-height:420px; overflow:auto; border:1px solid var(--outline); background:#fff; border-radius:10px">
                  </div>
                </div>
                <div id="colsEditor" style="display:grid; gap:10px"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Collections: Configuration (draft + settings) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="col-config">
        <div class="panel span-2">
          <div class="panel-header" style="align-items:center; justify-content:space-between">
            <h2>Configuration</h2>
            <div><button class="mini-btn" id="cfgPublish">Publish to Master</button></div>
          </div>
          <div class="cfg-split">
            <div class="panel" style="min-height:300px">
              <div class="panel-header">
                <h3>Draft (Demo)</h3><span class="muted">Pulls from Master data</span>
              </div>
              <div class="table-wrap" style="max-height:60vh; overflow:auto">
                <table class="table" id="cfgDemoTable"></table>
              </div>
            </div>
            <div class="panel">
              <div class="panel-header">
                <h3>Settings</h3>
              </div>
              <nav class="subnav" role="tablist" aria-label="Config subtabs">
                <button class="subtab is-active" role="tab" aria-selected="true" data-cfgtab="cfg-table">Table</button>
                <button class="subtab" role="tab" aria-selected="false" data-cfgtab="cfg-columns">Columns</button>
              </nav>
              <div id="cfgTablePanel">
                <div class="cfg-grid" style="display:grid; gap:8px; margin-top:8px">
                  <div class="cfg-row"><label>Aged On</label><input id="cfgAgedOn" type="date" /></div>
                  <div class="cfg-row"><label>Use Aliases</label><input id="cfgAliasGlobal" type="checkbox" /></div>
                  <div class="cfg-row"><label>Default View</label><select id="cfgDefaultView"></select></div>
                </div>
              </div>
              <div id="cfgColumnsPanel" style="display:none">
                <div
                  style="display:grid; grid-template-columns: 220px 1fr; gap:10px; align-items:start; margin-top:8px">
                  <div id="cfgColsList" style="max-height:50vh; overflow:auto"></div>
                  <div id="cfgColsEditor" style="display:grid; gap:8px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Admin subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Admin subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true" data-subtab="admin-overview">Overview</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-general">General</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-roles"
          data-perm="manageUsers">Roles</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-users"
          data-perm="manageUsers">Users</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-perms"
          data-perm="manageConfigs">Permissions</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-config"
          data-perm="manageConfigs">Config</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-notify"
          data-perm="manageConfigs">Notifications</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-templates"
          data-perm="manageConfigs">Templates</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-validate"
          data-perm="manageConfigs">Validation</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="admin-audit">Audit</button>
      </nav>
      <!-- Admin: Overview -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-overview">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Admin Overview</h2><span class="muted">Settings, roles, flags</span>
          </div>
          <div class="grid" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:12px">
            <div class="panel">
              <div class="panel-header">
                <h3>General</h3>
              </div>
              <div class="panel-body">
                <div class="cfg-grid">
                  <div class="cfg-row"><label>App Name</label><input id="adminAppNameOv" placeholder="My App" /></div>
                  <div class="cfg-row"><label>Timezone</label><input id="adminTzOv" placeholder="UTC" /></div>
                  <div class="cfg-row"><label>Current Role</label><select id="adminCurrentRole"></select></div>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="panel-header">
                <h3>Quick Toggles</h3>
              </div>
              <div class="panel-body">
                <div id="adminFlagsOv" class="cfg-grid"></div>
              </div>
            </div>
            <div class="panel">
              <div class="panel-header">
                <h3>Bundles</h3>
              </div>
              <div class="panel-body">
                <div class="cfg-grid">
                  <div class="cfg-row"><label>Config</label>
                    <div>
                      <button class="mini-btn" id="adminBundleExport">Export Bundle</button>
                      <button class="mini-btn" id="adminBundleImport">Import Bundle</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Admin: Users -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-users">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Users</h2>
            <div><button class="mini-btn" id="adminUserAdd">+ New User</button></div>
          </div>
          <table class="cfg-table" id="adminUsersTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Active</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
      <!-- Admin: Notifications -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-notify">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Notification Rules</h2>
            <div><button class="mini-btn" id="adminNotifyAdd">+ New Rule</button>
              <button class="mini-btn" id="adminNotifyExport">Export</button>
              <button class="mini-btn" id="adminNotifyImport">Import</button>
            </div>
          </div>
          <table class="cfg-table" id="adminNotifyTable">
            <thead>
              <tr>
                <th>Event</th>
                <th>Channel</th>
                <th>Recipients</th>
                <th>Condition</th>
                <th>Throttle</th>
                <th>Active</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="panel" style="margin-top:10px">
            <div class="panel-header">
              <h3>Simulate</h3>
            </div>
            <div class="cfg-grid">
              <div class="cfg-row"><label>Event</label><input id="adminNotifySimEvent" placeholder="invoice.past_due" />
              </div>
              <div class="cfg-row"><label>Payload (JSON)</label><textarea id="adminNotifySimPayload" rows="4"
                  placeholder='{"amount": 1200, "customer": "ACME"}'></textarea></div>
              <div class="cfg-row"><label></label><button class="mini-btn" id="adminNotifySimRun">Run</button></div>
              <div class="cfg-row"><label>Result</label>
                <div id="adminNotifySimResult" class="panel" style="padding:10px">—</div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Admin: Templates -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-templates">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Message Templates</h2>
            <div><button class="mini-btn" id="adminTplAdd">+ New Template</button>
              <button class="mini-btn" id="adminTplExport">Export</button>
              <button class="mini-btn" id="adminTplImport">Import</button>
            </div>
          </div>
          <div class="cfg-grid">
            <div class="cfg-row"><label>Templates</label>
              <select id="adminTplSelect"></select>
            </div>
            <div class="cfg-row"><label>Channel</label>
              <select id="adminTplChannel">
                <option>email</option>
                <option>slack</option>
                <option>gchat</option>
              </select>
            </div>
            <div class="cfg-row"><label>Key</label><input id="adminTplKey" placeholder="invoice_due" /></div>
            <div class="cfg-row"><label>Subject</label><input id="adminTplSubject"
                placeholder="Invoice {{invoice}} due" /></div>
            <div class="cfg-row"><label>Body</label><textarea id="adminTplBody" rows="6"
                placeholder="Hello {{name}}, ..."></textarea></div>
            <div class="cfg-row"><label>Preview</label>
              <div id="adminTplPreview" class="panel" style="padding:10px">—</div>
            </div>
            <div class="cfg-row"><label></label><button class="mini-btn" id="adminTplSave">Save</button></div>
          </div>
        </div>
      </section>
      <!-- Admin: Validation -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-validate">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Validation & Defaults</h2>
            <div><button class="mini-btn" id="adminValReset">Reset Defaults</button></div>
          </div>
          <table class="cfg-table" id="adminValTable">
            <thead>
              <tr>
                <th>Field</th>
                <th>Required</th>
                <th>Type</th>
                <th>Pattern</th>
                <th>Default</th>
                <th>Sample</th>
                <th>Result</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Toasts container -->
      <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>
      <!-- Admin: General -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-general">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>General Settings</h2>
          </div>
          <div class="cfg-grid" id="adminGeneralForm">
            <div class="cfg-row"><label>App Name</label><input id="adminAppName" placeholder="Startup XYZ" /></div>
            <div class="cfg-row"><label>Logo URL</label><input id="adminLogoUrl" placeholder="https://.../logo.png" />
            </div>
            <div class="cfg-row"><label>Theme</label>
              <select id="adminTheme">
                <option value="glass">Glass</option>
                <option value="outlined">Outlined</option>
                <option value="mint">Mint</option>
              </select>
            </div>
            <div class="cfg-row"><label>Timezone</label><input id="adminTimezone" placeholder="UTC" /></div>
            <div class="cfg-row"><label>UI Scale</label>
              <div>
                <input id="adminUiScale" type="range" min="0.6" max="1.2" step="0.01" style="vertical-align:middle" />
                <span id="adminUiScaleVal" class="muted" style="margin-left:8px">80%</span>
              </div>
            </div>
            <div class="cfg-row"><label></label><button class="mini-btn" id="adminGeneralSave">Save</button></div>
          </div>
        </div>
      </section>
      <!-- Admin: Roles -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-roles">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Roles</h2>
            <div><button class="mini-btn" id="adminRoleAdd">+ New Role</button></div>
          </div>
          <table class="cfg-table" id="adminRolesTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Users</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
      <!-- Admin: Permissions -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-perms">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Permissions</h2><span class="muted">Per role matrix</span>
          </div>
          <div id="adminPermsMatrix"></div>
        </div>
      </section>
      <!-- Admin: Config (Feature Flags) -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-config">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Feature Flags</h2>
            <div><button class="mini-btn" id="adminFlagAdd">+ New Flag</button></div>
          </div>
          <table class="cfg-table" id="adminFlagsTable">
            <thead>
              <tr>
                <th>Key</th>
                <th>Label</th>
                <th>Enabled</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
      <!-- Admin: Audit -->
      <section class="subtab-panel is-hidden" data-subtab-panel="admin-audit">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Audit Log</h2>
            <div><button class="mini-btn" id="adminAuditSeed">Seed</button></div>
          </div>
          <div class="table-wrap">
            <table class="table" id="adminAuditTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Actor</th>
                  <th>Action</th>
                  <th>Target</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="compliance-policies">
        <div class="panel">
          <div class="panel-header">
            <h2>Policies</h2>
          </div>
          <p class="muted">Documents and updates.</p>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="compliance-audits">
        <div class="panel">
          <div class="panel-header">
            <h2>Audits</h2>
          </div>
          <p class="muted">Upcoming audit schedule.</p>
        </div>
      </section>

      <!-- Settings subnav -->
      <nav class="subnav is-hidden" role="tablist" aria-label="Settings subtabs">
        <button class="subtab is-active" role="tab" aria-selected="true"
          data-subtab="settings-collections">Collections</button>
        <button class="subtab" role="tab" aria-selected="false" data-subtab="settings-general">General</button>
      </nav>
      <section class="subtab-panel is-hidden" data-subtab-panel="settings-collections">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>Collections Configuration</h2><span class="muted">Statuses, Templates, Tags, SLA, Display</span>
          </div>
          <div id="colCfgUnsaved" class="muted"
            style="display:none; padding:8px 10px; border:1px dashed var(--outline); border-radius:10px; background:#fff">
            Unsaved changes — <button class="mini-btn" id="colCfgSave">Save</button> <button class="mini-btn"
              id="colCfgDiscard">Discard</button></div>
          <div style="display:grid; grid-template-columns: 240px 1fr; gap:12px; align-items:start; margin-top:8px">
            <aside style="display:flex; flex-direction:column; gap:6px" id="colCfgNav">
              <button class="mini-btn" data-cfg-page="statuses">Statuses</button>
              <button class="mini-btn" data-cfg-page="templates">Note Templates</button>
              <button class="mini-btn" data-cfg-page="tags">Tags</button>
              <button class="mini-btn" data-cfg-page="sla">SLA Rules</button>
              <button class="mini-btn" data-cfg-page="display">Display & Density</button>
              <button class="mini-btn" data-cfg-page="io">Import / Export</button>
            </aside>
            <div id="colCfgBody" style="display:grid; gap:10px"></div>
          </div>
        </div>
      </section>
      <section class="subtab-panel is-hidden" data-subtab-panel="settings-general">
        <div class="panel span-2">
          <div class="panel-header">
            <h2>General Settings</h2>
          </div>
          <p class="muted">Project-wide preferences.</p>
        </div>
      </section>


    </main>
  </div>

  <script src="app.js"></script>
</body>

</html>
